<h1> TechMartApi </h1>

<h2> Команды</h2>

Установка библиотек:  
  ```
  pip install -r requirements.txt
  ```

Запуск сервера:  
```
uvicorn main:app --reload
```

Для просмотра документации и получения примеров заполнения напишите ```/docs``` в конце полученой ссылки
```
http://127.0.0.1:8000/docs
```

<h2>Настройте переменные окружения.</h2> 

Создайте файл .env в корневой папке проекта и заполните его:

```
# .env
SECRET_KEY="your_super_secret_key_that_is_long_and_random"
ALGORITHM="HS256"
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

<h2> Контроль доступа на основе ролей</h2>
<p>Система строго разделяет права доступа в зависимости от роли пользователя, что обеспечивает безопасность и логику бизнес-процессов.</p> 

Администраторы
* Имеют полный доступ ко всей системе.
* Могут просматривать список всех пользователей (включая других администраторов).
* Могут создавать и удалять товары.
* Могут удалять учетные записи работников и покупателей.
* ID администраторов для внутреннего учета начинается с префикса «a».

Работники
* Имеют права на управление товарами и покупателями.
* Могут просматривать список только работников и покупателей, но не видят администраторов.
* Могут создавать и удалять товары.
* Могут удалять только учетные записи покупателей.
* ID работников начинается с префикса «w».

Покупатели
* Имеют ограниченные права, предназначенные только для совершения покупок.
* Могут просматривать каталог товаров и покупать их.
* Не могут просматривать списки пользователей или управлять товарами.
* ID покупателей начинается с префикса «c».

<h2> Эндпоинты API </h2>
<p>API предоставляет следующие маршруты для взаимодействия с системой:</p>

Аутентификация (```BODY``` > ```raw```)
* POST ```/api/admin-reg``` — Регистрация администратора.
* POST ```/api/worker-reg``` — Регистрация работника.
* POST ```/api/customer-reg``` — Регистрация покупателя.
* POST ```/api/token``` — Вход в систему и получение токена доступа через Body, выберите form-data.
---
Добавьте два ключа (```BODY``` ```form-data```):

```username: myadmin```

```password: strongpassword```

Отправьте запрос. В ответе вы получите ```access_token```.

<h2>Доступ к защищенным эндпоинтам:</h2>

* Скопируйте полученный ```access_token```.
* Создайте новый запрос, например GET на ```http://127.0.0.1:8000/api/user/```.
* Перейдите во вкладку ```Authorization```.
* Выберите ```Type: Bearer Token```.
* Вставьте скопированный токен в поле ```Token```.
* Отправьте запрос. Вы получите список пользователей, так как у вас токен админа.

---
Управление пользователями
* GET ```/api/user/``` — Получить список пользователей (результат зависит от роли запрашивающего).
* GET ```/api/user/{user_id}``` — Получить информацию о конкретном пользователе.
* DELETE ```api/delete-user/{user_id}``` — Удалить пользователя (доступно администраторам и работникам с ограничениями).

Управление товарами
* GET ```/api/products/``` — Получить список всех товаров (доступно всем авторизованным пользователям).
* POST ```/api/products/``` — Создать новый товар (только для администраторов и работников).
* DELETE ```/api/products/{product_id}``` — Удалить товар (только для администраторов и работников).
* POST ```/api/products/{product_id}/purchase``` — Купить товар (только для покупателей).

Покупка товара (для покупателя):
---
Зарегистрируйтесь как ```customer``` и получите его токен.
Создайте POST запрос на 
```
http://127.0.0.1:8000/api/products/{product_id}/purchase
```
заменив ```{product_id}``` на реальный ID товара (например, ```p1```).
Настройте Authorization с токеном покупателя.

<h2>Тестирование</h2>

Для запуска автоматизированных тестов используйте pytest.

```
pytest
```
